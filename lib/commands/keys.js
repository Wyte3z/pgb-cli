const easyTable=require('easy-utf8-table'),format=require('./helpers/formatters'),has=require('./helpers/validators'),complete=require('./helpers/complete');module.exports=()=>{let a,b=[];has.signed_in(),a=has.key_platform(pgb.opts.commands[1],!1);const c=(a,b)=>(a=a?pgb.colours.error('LOCKED'):pgb.colours.done('UNLOCKED'),easyTable.rightPadder(' ')(a,b)),d=(a,d)=>{let e=pgb.colours.header('Platform: ')+pgb.colours.bold(d);if(e=e.concat('\n\n'),0===a.length)return e.concat('no keys\n\n');let f=new easyTable;return a.forEach(function(a){b.push(a.id),f.cell(pgb.colours.header('Key Id'),a.id.toString()),'ios'===d?(f.cell(pgb.colours.header('Title                     '),format.trunc(a.title,26)),f.cell(pgb.colours.header('Default  '),a.default?'YES':''),f.cell(pgb.colours.header('Status  '),a.locked,c)):'winphone'===d?f.cell(pgb.colours.header('Title                                          '),format.trunc(a.title,47)):(f.cell(pgb.colours.header('Title                                '),format.trunc(a.title,37)),f.cell(pgb.colours.header('Status  '),a.locked,c)),f.cell(pgb.colours.header('Last Used '),a.last_used?format.date(new Date(a.last_used)):'NEVER'),f.cell(pgb.colours.header('Uploaded  '),format.date(new Date(a.created_at))),f.newRow()}),e=e.concat(f.toString().trim()),e.concat('\n\n')},e=c=>{let e='\n';Array.isArray(c.keys)?e=e.concat(d(c.keys,a)):(e=e.concat(d(c.keys.ios.all,'ios')),e=e.concat(d(c.keys.android.all,'android')),e=e.concat(d(c.keys.windows.all,'windows')),e=e.concat(d(c.keys.winphone.all,'winphone'))),pgb.print({pretty:'\n'+e.trim()+'\n',json:c,bare:b.join('\n')})};return pgb.api.getKeys(a).then(e)},module.exports.completion=()=>complete.platform(!0);